<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Anotador de Truco</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <style>
        :root {
            --bg-color: #f8f9fa;
            --text-color: #333;
            --line-color: #ddd;
            --match-wood: linear-gradient(to bottom, #e3c193, #c5a16f);
            --match-head: radial-gradient(circle at 30% 30%, #ff5f40, #b22222);
            --accent-color: #ff4500;
            --font-main: 'Inter', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            user-select: none;
            outline: none;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-color);
            height: 100vh;
            height: 100dvh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        /* Header / Reset */
        header {
            height: auto;
            min-height: 60px;
            padding: 0 20px;
            padding-top: env(safe-area-inset-top, 10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--line-color);
            background-color: white;
            z-index: 10;
        }

        #reset-btn {
            background: none;
            border: 1px solid #ccc;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            color: #666;
            cursor: pointer;
            transition: all 0.2s;
        }

        #reset-btn:active {
            background-color: #eee;
            transform: scale(0.95);
        }

        /* Main Layout */
        main {
            flex: 1;
            display: flex;
            position: relative;
        }

        .divider {
            position: absolute;
            left: 50%;
            top: 10%;
            bottom: 30%;
            width: 1px;
            background-color: var(--line-color);
            transform: translateX(-50%);
        }

        .team-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
        }

        .team-name {
            font-size: 2rem;
            font-weight: 200;
            margin-bottom: 5px;
            color: #222;
        }

        .section-label {
            font-size: 0.65rem;
            letter-spacing: 0.1em;
            color: #999;
            margin-bottom: 5px;
            text-transform: uppercase;
        }

        .score-display {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 20px;
            align-items: center;
            justify-content: flex-start;
        }

        .boxes-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
            height: 210px;
            /* Space for 3 boxes */
            justify-content: flex-start;
            align-items: center;
        }

        /* Matchstick Logic */
        .match-box {
            width: 60px;
            min-height: 60px;
            position: relative;
            animation: boxAppear 0.3s ease-out;
        }

        @keyframes boxAppear {
            from {
                opacity: 0;
                transform: scale(0.8);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .match {
            position: absolute;
            border-radius: 2px;
            background: var(--match-wood);
            box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
            animation: matchAppear 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .match::after {
            content: '';
            position: absolute;
            background: var(--match-head);
            border-radius: 50%;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.2);
        }

        @keyframes matchAppear {
            from {
                opacity: 0;
                transform: scale(1.5);
            }

            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        @keyframes diagonalAppear {
            from {
                opacity: 0;
                transform: translate(-50%, -50%) rotate(45deg) scale(1.5);
            }

            to {
                opacity: 1;
                transform: translate(-50%, -50%) rotate(45deg) scale(1);
            }
        }

        /* Positions */
        /* 1: Left */
        .match-1 {
            left: 5px;
            top: 5px;
            bottom: 5px;
            width: 4px;
        }

        .match-1::after {
            top: -2px;
            left: -1px;
            width: 6px;
            height: 8px;
        }

        /* 2: Top */
        .match-2 {
            left: 5px;
            right: 5px;
            top: 5px;
            height: 4px;
        }

        .match-2::after {
            top: -1px;
            right: -2px;
            width: 8px;
            height: 6px;
        }

        /* 3: Right */
        .match-3 {
            right: 5px;
            top: 5px;
            bottom: 5px;
            width: 4px;
        }

        .match-3::after {
            bottom: -2px;
            left: -1px;
            width: 6px;
            height: 8px;
        }

        /* 4: Bottom */
        .match-4 {
            left: 5px;
            right: 5px;
            bottom: 5px;
            height: 4px;
        }

        .match-4::after {
            bottom: -1px;
            left: -2px;
            width: 8px;
            height: 6px;
        }

        /* 5: Diagonal (Cross) */
        .match-5 {
            left: 50%;
            top: 50%;
            width: 4px;
            height: 75px;
            transform: translate(-50%, -50%) rotate(45deg);
            z-index: 10;
            animation: diagonalAppear 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }

        .match-5::after {
            top: -2px;
            left: -1px;
            width: 6px;
            height: 8px;
        }

        .match-box.completed {
            animation: completedGlow 0.5s ease-out;
        }

        @keyframes completedGlow {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
                filter: drop-shadow(0 0 5px var(--accent-color));
            }

            100% {
                transform: scale(1);
            }
        }

        /* Controls */
        .controls {
            display: flex;
            height: auto;
            min-height: 90px;
            padding: 10px 20px;
            padding-bottom: calc(20px + env(safe-area-inset-bottom, 0px));
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid var(--line-color);
            background-color: white;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
        }

        .btn {
            width: 50px;
            height: 50px;
            border: 1px solid #ddd;
            border-radius: 50%;
            background-color: white;
            font-size: 1.5rem;
            color: #444;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        .btn:active {
            background-color: #f0f0f0;
            transform: scale(0.9);
        }

        .btn-minus {
            font-size: 1.2rem;
            color: #999;
            width: 40px;
            height: 40px;
        }

        /* Winner Banner */
        #banner {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(5px);
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 100;
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        .banner-content {
            background: white;
            padding: 30px 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            text-align: center;
            max-width: 80%;
        }

        .banner-content h2 {
            font-size: 1.2rem;
            font-weight: 400;
            margin-bottom: 10px;
            color: #666;
        }

        .banner-content p {
            font-size: 1.8rem;
            font-weight: 700;
            color: #222;
        }

        .banner-close {
            margin-top: 20px;
            padding: 8px 20px;
            background: #eee;
            border: none;
            border-radius: 10px;
            font-size: 0.9rem;
            color: #666;
        }

        /* Score Footer Hint */
        .total-score {
            font-size: 1.8rem;
            font-weight: 700;
            color: #000;
            margin-bottom: 5px;
        }

        /* Menu Screen */
        #menu-screen {
            height: 100vh;
            height: 100dvh;
            width: 100vw;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: radial-gradient(circle at center, #ffffff 0%, #f0f0f0 100%);
            z-index: 1000;
            text-align: center;
            padding: 20px;
        }

        .menu-logo {
            width: 120px;
            height: 120px;
            margin-bottom: 30px;
            position: relative;
            background: white;
            border-radius: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .logo-match {
            width: 8px;
            height: 80px;
            background: var(--match-wood);
            border-radius: 4px;
            position: relative;
            transform: rotate(-15deg);
        }

        .logo-match::after {
            content: '';
            position: absolute;
            top: -4px;
            left: -2px;
            width: 12px;
            height: 16px;
            background: var(--match-head);
            border-radius: 50%;
        }

        #menu-screen h1 {
            font-size: 2.5rem;
            font-weight: 800;
            color: #222;
            margin-bottom: 10px;
            letter-spacing: -0.02em;
        }

        #menu-screen p {
            font-size: 1rem;
            color: #888;
            margin-bottom: 50px;
        }

        .btn-start {
            background-color: #222;
            color: white;
            border: none;
            padding: 18px 45px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .btn-start:active {
            transform: scale(0.95);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }

        #game-screen {
            display: none;
            height: 100vh;
            height: 100dvh;
            flex-direction: column;
        }

        /* Navbar removed duplicate */

        #home-btn {
            background: #eee;
            border: none;
            padding: 6px 15px;
            border-radius: 10px;
            font-size: 0.8rem;
            color: #666;
            font-weight: 500;
            cursor: pointer;
        }

        .btn-menu-group {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .btn-start.secondary {
            background-color: white;
            color: #222;
            border: 2px solid #222;
            box-shadow: none;
            display: none;
            /* Only show if game in progress */
        }
    </style>
</head>

<div id="menu-screen">
    <div class="menu-logo">
        <div class="logo-match"></div>
    </div>
    <h1>Anotador de truco</h1>
    <p>Precisión en cada tanto.</p>
    <div class="btn-menu-group">
        <button class="btn-start" onclick="newGame()">Iniciar Partido</button>
        <button class="btn-start secondary" id="continue-btn" onclick="startGame(true)">Continuar Partido</button>
    </div>
</div>

<div id="game-screen">
    <header>
        <button id="home-btn" onclick="showMenu()">Menu principal</button>
        <button id="reset-btn" onclick="reset()">Reset</button>
    </header>

    <main>
        <div class="divider"></div>

        <!-- Team N -->
        <div class="team-panel" onclick="addPoint('N')">
            <div class="team-name">N</div>

            <div class="score-display">
                <div class="section">
                    <div class="section-label">Malas</div>
                    <div id="malas-N" class="boxes-container"></div>
                </div>

                <div class="section">
                    <div class="section-label">Buenas</div>
                    <div id="buenas-N" class="boxes-container"></div>
                </div>
            </div>
            <div class="total-score" id="total-N">0</div>
        </div>

        <!-- Team E -->
        <div class="team-panel" onclick="addPoint('E')">
            <div class="team-name">E</div>

            <div class="score-display">
                <div class="section">
                    <div class="section-label">Malas</div>
                    <div id="malas-E" class="boxes-container"></div>
                </div>

                <div class="section">
                    <div class="section-label">Buenas</div>
                    <div id="buenas-E" class="boxes-container"></div>
                </div>
            </div>
            <div class="total-score" id="total-E">0</div>
        </div>
    </main>

    <div class="controls">
        <div class="btn-group">
            <button class="btn btn-minus" onclick="subPoint('N', event)">-</button>
            <button class="btn btn-plus" onclick="addPoint('N', event)">+</button>
        </div>
        <div class="btn-group">
            <button class="btn btn-minus" onclick="subPoint('E', event)">-</button>
            <button class="btn btn-plus" onclick="addPoint('E', event)">+</button>
        </div>
    </div>
</div>

<div id="banner" onclick="this.style.display='none'">
    <div class="banner-content">
        <h2>Partida finalizada</h2>
        <p id="winner-text"></p>
        <button class="banner-close">Cerrar</button>
    </div>
</div>

<script>
    let scores = { N: 0, E: 0 };
    let gameOver = false;

    // Init
    document.addEventListener('DOMContentLoaded', () => {
        const saved = localStorage.getItem('truco-scores');
        const inGame = localStorage.getItem('truco-playing');

        if (saved) {
            scores = JSON.parse(saved);
            if (scores.N >= 30 || scores.E >= 30) {
                gameOver = true;
            }
        }

        if (inGame === 'true') {
            startGame(true);
        } else {
            showMenu();
        }

        render();
    });

    function newGame() {
        if (scores.N > 0 || scores.E > 0) {
            if (!confirm('Esto reiniciará el marcador. ¿Continuar?')) return;
        }
        scores = { N: 0, E: 0 };
        gameOver = false;
        document.getElementById('banner').style.display = 'none';
        save();
        render();
        startGame();
    }
    window.newGame = newGame;

    function startGame(skipSave = false) {
        document.getElementById('menu-screen').style.display = 'none';
        document.getElementById('game-screen').style.display = 'flex';
        if (!skipSave) {
            localStorage.setItem('truco-playing', 'true');
        }
    }
    window.startGame = startGame;

    function showMenu() {
        document.getElementById('menu-screen').style.display = 'flex';
        document.getElementById('game-screen').style.display = 'none';
        localStorage.setItem('truco-playing', 'false');

        // Show continue button if there's progress
        const continueBtn = document.getElementById('continue-btn');
        if (scores.N > 0 || scores.E > 0) {
            continueBtn.style.display = 'block';
        } else {
            continueBtn.style.display = 'none';
        }
    }
    window.showMenu = showMenu;

    function save() {
        localStorage.setItem('truco-scores', JSON.stringify(scores));
    }

    function addPoint(team, event) {
        if (event) event.stopPropagation();
        if (gameOver) return;

        if (scores[team] < 30) {
            scores[team]++;
            save();
            render();

            if (scores[team] === 30) {
                showWinner(team);
            }
        }
    }

    function subPoint(team, event) {
        if (event) event.stopPropagation();

        if (scores[team] > 0) {
            scores[team]--;
            gameOver = false; // Allow adding again if score drops
            save();
            render();
        }
    }

    function reset() {
        if (confirm('¿Reiniciar la partida?')) {
            scores = { N: 0, E: 0 };
            gameOver = false;
            document.getElementById('banner').style.display = 'none';
            save();
            render();
        }
    }
    window.reset = reset;

    function showWinner(team) {
        gameOver = true;
        document.getElementById('winner-text').innerText = `Ganó ${team}`;
        document.getElementById('banner').style.display = 'flex';
    }

    function render() {
        renderTeam('N');
        renderTeam('E');
    }

    function renderTeam(team) {
        const total = scores[team];
        document.getElementById(`total-${team}`).innerText = total;

        const malas = Math.min(total, 15);
        const buenas = Math.max(0, total - 15);

        renderSection(`malas-${team}`, malas);
        renderSection(`buenas-${team}`, buenas);
    }

    function renderSection(containerId, count) {
        const container = document.getElementById(containerId);

        // Current number of boxes shown
        const boxesNeeded = Math.ceil(count / 5);

        // Clear or update efficiently
        // For simplicity and to handle animations on new matches, we'll reconcile

        const currentBoxes = container.querySelectorAll('.match-box');

        // If we need fewer boxes than we have, just re-render (usually on sub)
        if (boxesNeeded < currentBoxes.length) {
            container.innerHTML = '';
        }

        for (let i = 0; i < boxesNeeded; i++) {
            let box = container.children[i];
            if (!box) {
                box = document.createElement('div');
                box.className = 'match-box';
                container.appendChild(box);
            }

            // Points in this box
            const pointsInBox = Math.min(5, count - (i * 5));

            // Update matches inside box
            const currentMatches = box.querySelectorAll('.match').length;

            if (pointsInBox < currentMatches) {
                box.innerHTML = ''; // Reset if points decreased
            }

            for (let p = box.querySelectorAll('.match').length + 1; p <= pointsInBox; p++) {
                const match = document.createElement('div');
                match.className = `match match-${p}`;
                box.appendChild(match);

                if (p === 5) {
                    box.classList.add('completed');
                }
            }

            if (pointsInBox < 5) {
                box.classList.remove('completed');
            }
        }

        // Remove extra boxes if count decreased
        while (container.children.length > boxesNeeded) {
            container.removeChild(container.lastChild);
        }
    }
</script>
</body>

</html>